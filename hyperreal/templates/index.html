{% extends "base.html" %}

{% block title %}Feature Clustering{% endblock %}

{% block content %}
<details>
    <summary>Edit Clusters</summary>
    <form method="post" action="/index/{{ index_id }}/cluster/delete">
        <label for="cluster_selection">Choose clusters:</label>
        <select name="cluster_id" id="cluster_selection" multiple>
            {% for cluster_id, features in clusters %}
            <option value="{{ cluster_id }}">
                {% for feature_id, field, value, count in features %}
                {{ field }}: {{ value }}
                {% endfor %}
            </option>
            {% endfor %}
        </select>
        <button type="submit">Delete Clusters 🗑️</button>
        <button type="submit" formaction="/index/{{ index_id }}/cluster/merge" method="post">Merge Clusters</button>
    </form>
</details>

<ul class="cluster-list">

    {% for cluster_id, features in clusters[:1] %}
    <li>
        <ul class="compact-cluster">
            {% for feature_id, field, value, score in features %}
            <li><a class="feature-link" href=/index/{{ index_id }}/?feature_id={{ feature_id }}>{{ field }}: {{ value }}</a><!-- ({{ score }}) --></li>
            {% endfor %}
            <a href="/index/{{ index_id }}/cluster/{{ cluster_id }}">...</a>
        </ul>
        <a href="/index/{{ index_id }}/?cluster_id={{ cluster_id }}">Pivot</a>
        <details>
            <summary>Edit</summary>
            <form method="post" action="/cluster/delete">
                <input type="hidden" name="cluster_id" value="{{ cluster_id }}">
                <button class="inline-button" type="submit">Delete 🗑️</button>
            </form>
        </details>
    </li>
    {% endfor %}
    {% if rendered_docs %}
    <li>
        <p>{% if rendered_docs|length < total_docs %}Sample of the {{ total_docs }} matching documents.{% else %}All {{ total_docs }} matching documents.{% endif %}</p>
        <ul class="doc-list">
            {% for doc_id, doc in rendered_docs %}
            <li>{{ doc }}</li>
            {% endfor %}
        </ul>
    </li>
    {% endif %}
    {% for cluster_id, features in clusters[1:] %}
    <li>
        <ul class="compact-cluster">
            {% for feature_id, field, value, score in features %}
            <li><a class="feature-link" href=/index/{{ index_id }}/?feature_id={{ feature_id }}>{{ field }}: {{ value }}</a><!-- ({{ score }}) --></li>
            {% endfor %}
            <a href="/index/{{ index_id }}/cluster/{{ cluster_id }}">...</a>
        </ul>
        <a href="/index/{{ index_id }}/?cluster_id={{ cluster_id }}">Pivot</a>
        <details>
            <summary>Edit</summary>
            <form method="post" action="/cluster/delete">
                <input type="hidden" name="cluster_id" value="{{ cluster_id }}">
                <button class="inline-button" type="submit">Delete 🗑️</button>
            </form>
        </details>
    </li>
    {% endfor %}
</ul>
{% endblock %}
